name: Ansible macOS

on:
  pull_request:
    paths:
    - .github/workflows/build_mac.yml
    - ansible/**
    branches:         
    - master

jobs:
  build-macos:
    name: macOS 10.15
    runs-on: macos-10.15
    steps:

    - uses: actions/checkout@v2

    - name: Install dependencies
      run: brew install ansible

    - name: Run Ansible Playbook
      run: |
        echo "localhost ansible_connection=local" > /ansible/hosts
        set -eux
        cd /ansible; \
        ansible-playbook -i hosts ansible/playbooks/AdoptOpenJDK_Unix_Playbook/main.yml --skip-tags="debug,hosts_file,hostname,adoptopenjdk,jenkins,nagios,superuser,docker,swap_file,crontab,nvidia_cuda_toolkit"
